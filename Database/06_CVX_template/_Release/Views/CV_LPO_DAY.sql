CREATE OR REPLACE VIEW CV_LPO_DAY AS 
  SELECT D.EVENT_NO,
          D.PARENT_EVENT_NO,
          D.PARENT_MASTER_EVENT_ID,
          D.PARENT_OBJECT_ID,
          D.PARENT_DAYTIME,
          D.MASTER_EVENT_ID,
          D.OBJECT_ID,
          D.OBJECT_TYPE,
          D.DEFERMENT_TYPE,
          D.EVENT_TYPE,
          S.DAYTIME AS DAYTIME,
          D.DAYTIME AS START_DATE,
          D.END_DATE,
          D.EQUIPMENT_ID,
          D.REASON_CODE_1,
          D.REASON_CODE_2,
          D.REASON_CODE_3,
          D.REASON_CODE_4,
          D.OIL_LOSS_RATE,
          D.GAS_LOSS_RATE,
          D.COND_LOSS_RATE,
          D.WATER_INJ_LOSS_RATE,
          D.WATER_LOSS_RATE,
          D.GAS_INJ_LOSS_RATE,
          D.STEAM_INJ_LOSS_RATE,
          D.OIL_LOSS_VOLUME,
          D.GAS_LOSS_VOLUME,
          D.COND_LOSS_VOLUME,
          D.WATER_INJ_LOSS_VOLUME,
          D.WATER_LOSS_VOLUME,
          D.GAS_INJ_LOSS_VOLUME,
          D.STEAM_INJ_LOSS_VOLUME,
          D.STATUS,
          D.COMMENTS,
          GREATEST (
             (LEAST (NVL (D.END_DATE, S.DAYTIME + nvl(D.VALUE_2,0) + 1),
                     S.DAYTIME + nvl(D.VALUE_2,0) + 1)
              - GREATEST (D.DAYTIME, S.DAYTIME + nvl(D.VALUE_2,0)))
             * 24,
             0)
             AS DUR_HRS_DAY,
          D.TEXT_1,
          D.TEXT_2,
          D.TEXT_3,
          D.TEXT_4,
          D.VALUE_1,
          D.VALUE_2,
          D.VALUE_3,
          D.VALUE_4,
          D.VALUE_5,
          D.VALUE_6,
          D.VALUE_7,
          D.VALUE_8,
          D.VALUE_9,
          D.VALUE_10,
          D.RECORD_STATUS,
          D.CREATED_BY,
          D.CREATED_DATE,
          D.LAST_UPDATED_BY,
          D.LAST_UPDATED_DATE,
          D.REV_NO,
          D.REV_TEXT,
          D.APPROVAL_BY,
          D.APPROVAL_DATE,
          D.APPROVAL_STATE,
          D.REC_ID
     FROM DEFERMENT_EVENT D, SYSTEM_DAYS S
    WHERE S.DAYTIME + NVL(D.VALUE_2,0) > D.DAYTIME - 1
    AND (S.DAYTIME + NVL (D.VALUE_2,0) < D.END_DATE OR D.END_DATE IS NULL)
    AND S.DAYTIME + NVL(D.VALUE_2,0) < ECDP_DATE_TIME.GETCURRENTSYSDATE - 1;
