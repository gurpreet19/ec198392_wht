---------------------------------------------------------------------------------------------------
--  CV_PTST_PWEL_RESULT_RBF
--
--  Purpose:   		Consolidates PTST and PWEL data
--			Different from existing PTST_PWEL_RESULT data class in that this one
--			includes all available columns
--
-- 			Joins to bring in reservoir data.
--
--			
--  Notes:
--
--  	MVAS 05/2008	New
--      HNKO 07/2008    Included the version tables and added the additional columns from 9.3
----------------------------------------------------------------------------------------------------- 

CREATE OR REPLACE VIEW CV_PTST_PWEL_RESULT_RBF
AS
SELECT
    TRUNC(PTST.DAYTIME,'DD') AS DAYTIME,
-- PTST
      PTST.DAYTIME AS START_DATE,
      PTST.END_DATE,
      PTST.DURATION,
      PTST.PRODUCTION_DAY,
      PTST.TEST_TYPE,
      PTST.ESTIMATE_TYPE,
      PTST.TEST_NO,
      PTST.SUMMARISED_IND,
    PTST.VALID_FROM_DATE,
    PTST.STATUS,
      PTST.PREPROCESS_LOG,
      PTST.USE_CALC AS PT_USE_CALC,
    PTST.FACILITY_ID,
    PTST.COMMENTS AS PT_COMMENTS,
      PTST.VALUE_1 AS PT_VALUE_1,
      PTST.VALUE_2 AS PT_VALUE_2,
      PTST.VALUE_3 AS PT_VALUE_3,
      PTST.VALUE_4 AS PT_VALUE_4,
      PTST.VALUE_5 AS PT_VALUE_5,
      PTST.VALUE_6 AS PT_VALUE_6,
      PTST.VALUE_7 AS PT_VALUE_7,
     PTST.VALUE_8 AS PT_VALUE_8,
      PTST.VALUE_9 AS PT_VALUE_9,
      PTST.VALUE_10 AS PT_VALUE_10,
      PTST.TEXT_1 AS PT_TEXT_1,
      PTST.TEXT_2 AS PT_TEXT_2,
      PTST.TEXT_3 AS PT_TEXT_3,
      PTST.TEXT_4 AS PT_TEXT_4,
-- PWEL
    PWEL.OBJECT_ID,
      PWEL.RESULT_NO,
      PWEL.RESULT_NO_COMB,      
      PWEL.PRIMARY_IND,
      PWEL.FLOWING_IND,
      PWEL.CHOKE_SIZE,
      PWEL.WH_USC_PRESS,
      PWEL.WH_USC_TEMP,
      PWEL.WH_DSC_PRESS,
      PWEL.WH_DSC_TEMP,
    PWEL.WH_PRESS,
    PWEL.WH_TEMP,
     PWEL.BH_PRESS,
    PWEL.BH_TEMP,
    PWEL.ANNULUS_PRESS,
     PWEL.ANNULUS_TEMP,
      PWEL.SAND_RATE,
      PWEL.EROSION_RATE,
    PWEL.NET_OIL_RATE_ADJ,
    PWEL.GAS_RATE_ADJ,
      PWEL.NET_COND_RATE_ADJ,
    PWEL.TOT_WATER_RATE_ADJ,
    PWEL.NET_OIL_DENSITY_ADJ,
      PWEL.GAS_DENSITY_ADJ,
      PWEL.NET_COND_DENSITY_ADJ AS NET_CND_DENSITY_ADJ,
      PWEL.TOT_WATER_DENSITY_ADJ AS TOT_WAT_DENSITY_ADJ,
      PWEL.MPM_OIL_RATE_FLC,
      PWEL.MPM_OIL_RATE,            
      PWEL.MPM_OIL_DENSITY,          
      PWEL.MPM_GAS_RATE_FLC,         
      PWEL.MPM_GAS_RATE,            
      PWEL.MPM_GAS_DENSITY,          
      PWEL.MPM_WATER_RATE_FLC,      
      PWEL.MPM_WATER_RATE,           
      PWEL.MPM_MIX_DENSITY,         
      PWEL.MPM_PRESS,                
      PWEL.MPM_TEMP,                
      PWEL.MPM_COND_RATE,           
      PWEL.MPM_OIL_MASS_RATE AS MPM_OIL_M_RATE,        
      PWEL.MPM_GAS_MASS_RATE AS MPM_GAS_M_RATE,       
      PWEL.MPM_COND_MASS_RATE AS MPM_COND_M_RATE,       
      PWEL.MPM_WATER_MASS_RATE AS MPM_WATER_M_RATE,     
      PWEL.MPM_COND_DENSITY,        
      PWEL.MPM_WATER_DENSITY,       
      PWEL.MPM_COND_RATE_FLC,       
      PWEL.MPM_OIL_MASS_RATE_FLC AS MPM_OIL_M_RATE_FLC,   
      PWEL.MPM_GAS_MASS_RATE_FLC AS MPM_GAS_M_RATE_FLC,   
      PWEL.MPM_COND_MASS_RATE_FLC AS MPM_COND_M_RATE_FLC,  
      PWEL.MPM_WATER_MASS_RATE_FLC AS MPM_WATER_M_RATE_FLC, 
      PWEL.MPM_OIL_DENSITY_FLC,     
      PWEL.MPM_GAS_DENSITY_FLC,     
      PWEL.MPM_COND_DENSITY_FLC AS MPM_CND_DENSITY_FLC,    
      PWEL.MPM_WATER_DENSITY_FLC AS MPM_WAT_DENSITY_FLC,   
      PWEL.MPM_MIX_DENSITY_FLC,     
      PWEL.MPM_CONDUCT,             
      PWEL.MPM_CONDUCT_TEMP,        
      PWEL.MPM_OIL_RATE_RAW,         
      PWEL.MPM_GAS_RATE_RAW,        
      PWEL.MPM_WATER_RATE_RAW,   
    PWEL.MPM_OIL_MASS_RATE_RAW AS MPM_OIL_M_RATE_RAW,
    PWEL.MPM_GAS_MASS_RATE_RAW AS MPM_GAS_M_RATE_RAW,
    PWEL.MPM_WATER_MASS_RATE_RAW AS MPM_WATER_M_RATE_RAW,
    PWEL.MPM_OIL_DENSITY_RAW,
    PWEL.MPM_GAS_DENSITY_RAW,
    PWEL.MPM_WATER_DENSITY_RAW AS MPM_WAT_DENSITY_RAW,
    PWEL.MPM_MIX_DENSITY_RAW,
    PWEL.PUMP_SPEED,
    PWEL.PUMP_POWER,
    PWEL.PUMP_STROKE,
    PWEL.PUMP_TIMER,
    PWEL.DRIVE_CURRENT,
      PWEL.DRIVE_VOLTAGE,           
      PWEL.LIQUID_LEVEL,            
    PWEL.DRIVE_FREQUENCY,
      PWEL.DILUENT_RATE,            
    PWEL.GL_CHOKE_SIZE,
    PWEL.GL_PRESS,
    PWEL.GL_TEMP,
      PWEL.GL_RATE, 
    PWEL.GL_DENSITY,
    PWEL.GL_DIFF_PRESS,                 
      PWEL.EST_GL_RATE,              
      PWEL.EST_DILUENT_RATE,         
      PWEL.DECLINE_RATE_OIL,        
    PWEL.PUMP_RUNTIME,             
      PWEL.OIL_SHRINKAGE,            
      PWEL.SOLUTION_GAS_FACTOR,     
      PWEL.GAS_SP_GRAV,             
    PWEL.CHLORIDE,                
     PWEL.EMULSION,                 
      PWEL.FORMATION_GLR,           
      PWEL.GOR,                     
      PWEL.CGR,                     
      PWEL.GLR,                    
    PWEL.WATERCUT_PCT,            
     PWEL.SAND_CONTENT,        
      PWEL.GAS_OUT_RATE,            
      PWEL.OIL_OUT_RATE,             
      PWEL.TDEV_PRESS,              
      PWEL.TDEV_TEMP,               
      PWEL.GAS_RATE,                
      PWEL.EST_NET_OIL_RATE,         
      PWEL.EST_GAS_RATE,            
      PWEL.EST_NET_COND_RATE,       
      PWEL.EST_WATER_RATE,          
      PWEL.NET_OIL_MASS_RATE_ADJ AS NET_OIL_M_RATE_ADJ,   
      PWEL.GAS_MASS_RATE_ADJ AS GAS_M_RATE_ADJ,        
      PWEL.NET_COND_MASS_RATE_ADJ AS NET_COND_M_RATE_ADJ,   
      PWEL.TOT_WATER_MASS_RATE_ADJ AS TOT_WATER_M_RATE_ADJ, 
      PWEL.WET_DRY_GAS_RATIO,       
      PWEL.WGR,                    
      PWEL.TREND_ANALYSIS_IND,      
      PWEL.TREND_RESET_IND,          
    PWEL.POWERWATER_RATE,
    PWEL.EST_POWERWATER_RATE,
    PWEL.FWS_RATE,
    PWEL.WELL_METER_FACTOR,
    PWEL.TEST_DEVICE,
    PWEL.WT_MULTISELECT,
    PWEL.USE_CALC AS PW_USE_CALC,  
    PWEL.RATE_SOURCE,
    PWEL.WET_GAS_GRAVITY,
    PWEL.AVG_FLOW_MASS,    
      PWEL.COMMENTS AS PW_COMMENTS,
      PWEL.VALUE_1 AS PW_VALUE_1,                 
      PWEL.VALUE_2 AS PW_VALUE_2,                 
      PWEL.VALUE_3 AS PW_VALUE_3,                 
      PWEL.VALUE_4 AS PW_VALUE_4,                 
      PWEL.VALUE_5 AS PW_VALUE_5,                 
      PWEL.VALUE_6 AS PW_VALUE_6,                 
      PWEL.VALUE_7 AS PW_VALUE_7,                 
      PWEL.VALUE_8 AS PW_VALUE_8,                 
      PWEL.VALUE_9 AS PW_VALUE_9,                 
      PWEL.VALUE_10 AS PW_VALUE_10,                
      PWEL.VALUE_11 AS PW_VALUE_11,                
      PWEL.VALUE_12 AS PW_VALUE_12,                
      PWEL.VALUE_13 AS PW_VALUE_13,                 
      PWEL.VALUE_14 AS PW_VALUE_14,                 
      PWEL.VALUE_15 AS PW_VALUE_15,                
      PWEL.VALUE_16 AS PW_VALUE_16,                
      PWEL.VALUE_17 AS PW_VALUE_17,                
      PWEL.VALUE_18 AS PW_VALUE_18,                
      PWEL.VALUE_19 AS PW_VALUE_19,                
      PWEL.VALUE_20 AS PW_VALUE_20,                
      PWEL.VALUE_21 AS PW_VALUE_21,                
      PWEL.VALUE_22 AS PW_VALUE_22,                
      PWEL.VALUE_23 AS PW_VALUE_23,                
      PWEL.VALUE_24 AS PW_VALUE_24,                 
      PWEL.VALUE_25 AS PW_VALUE_25,                 
      PWEL.VALUE_26 AS PW_VALUE_26,                 
      PWEL.VALUE_27 AS PW_VALUE_27,                 
      PWEL.VALUE_28 AS PW_VALUE_28,                
      PWEL.VALUE_29 AS PW_VALUE_29,                
      PWEL.VALUE_30 AS PW_VALUE_30, 
      PWEL.TEXT_1 AS PW_TEXT_1,                
      PWEL.TEXT_2 AS PW_TEXT_2,                 
      PWEL.TEXT_3 AS PW_TEXT_3,               
      PWEL.TEXT_4 AS PW_TEXT_4,                  
      PWEL.TEXT_5 AS PW_TEXT_5,                 
      PWEL.TEXT_6 AS PW_TEXT_6,                
      PWEL.TEXT_7 AS PW_TEXT_7,                
      PWEL.TEXT_8 AS PW_TEXT_8,                
      PWEL.TEXT_9 AS PW_TEXT_9,               
      PWEL.TEXT_10 AS PW_TEXT_10,               
      PWEL.TEXT_11 AS PW_TEXT_11,               
      PWEL.TEXT_12 AS PW_TEXT_12,               
      PWEL.TEXT_13 AS PW_TEXT_13,               
      PWEL.TEXT_14 AS PW_TEXT_14,               
      PWEL.TEXT_15 AS PW_TEXT_15,
--
        WB.OBJECT_ID AS WELL_BORE_ID,
        WB.OBJECT_CODE AS WELL_BORE_CODE, 
        WBI.OBJECT_ID AS WELL_BORE_INTERVAL_ID,
        WBI.OBJECT_CODE AS WELL_BORE_INTERVAL_CODE, 
        PI.OBJECT_ID AS PERF_INTERVAL_ID,
        PI.OBJECT_CODE AS PERF_INTERVAL_CODE,
        PIV.RESV_BLOCK_FORMATION_ID, -- Added this join cause 111 moved the resv_block_formation_id from perf_interval to perf_interval_version
--
    PWEL.RECORD_STATUS,
    PWEL.CREATED_BY,
    PWEL.CREATED_DATE,
    PWEL.LAST_UPDATED_BY,
    PWEL.LAST_UPDATED_DATE,
    PWEL.REV_NO,
    PWEL.REV_TEXT,
    PWEL.APPROVAL_BY,
    PWEL.APPROVAL_DATE,
    PWEL.APPROVAL_STATE,
    PWEL.REC_ID
FROM PWEL_RESULT PWEL, 
    PTST_RESULT PTST,
    WEBO_BORE WB,
    WEBO_VERSION WBV,
    WEBO_INTERVAL WBI,
    WEBO_INTERVAL_VERSION WBIV,
    PERF_INTERVAL PI,
    PERF_INTERVAL_VERSION PIV
WHERE   PTST.RESULT_NO = PWEL.RESULT_NO AND
        PWEL.OBJECT_ID = WB.WELL_ID AND
        WB.START_DATE >= EC_WELL.START_DATE(PWEL.OBJECT_ID) AND 
        (WB.END_DATE IS NULL OR WB.END_DATE < NVL(EC_WELL.END_DATE(PWEL.OBJECT_ID),WB.END_DATE+1)) AND
        WB.OBJECT_ID=WBV.OBJECT_ID AND
        (WBV.END_DATE IS NULL OR WBV.END_DATE < NVL(WB.END_DATE,WBV.END_DATE+1)) AND
--
        WB.OBJECT_ID = WBI.WELL_BORE_ID AND
        WBI.START_DATE >= WB.START_DATE AND
        (WBI.END_DATE IS NULL OR WBI.END_DATE < NVL(WB.END_DATE,WBI.END_DATE+1)) AND
        WBI.OBJECT_ID=WBIV.OBJECT_ID AND
        (WBIV.END_DATE IS NULL OR WBIV.END_DATE < NVL(WBI.END_DATE,WBIV.END_DATE+1)) AND
--
        WBI.OBJECT_ID = PI.WEBO_INTERVAL_ID AND
        PI.START_DATE >= WBI.START_DATE AND
        (PI.END_DATE IS NULL OR PI.END_DATE < NVL(WBI.END_DATE,PI.END_DATE+1)) AND
        PI.OBJECT_ID=PIV.OBJECT_ID AND 
        (PIV.END_DATE IS NULL OR PIV.END_DATE < NVL(PI.END_DATE,PIV.END_DATE+1)) 
       ;