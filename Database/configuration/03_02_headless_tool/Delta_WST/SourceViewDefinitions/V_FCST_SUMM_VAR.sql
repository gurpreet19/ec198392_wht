CREATE OR REPLACE FORCE EDITIONABLE VIEW "V_FCST_SUMM_VAR" ("FORECAST_ID", "OBJECT_ID", "FROM_MONTH", "TO_MONTH", "VARIABLE_CODE", "VARIABLE_NAME", "SORT_ORDER", "OIL", "GAS", "WAT", "COND", "GL", "DL", "WI", "GI", "SI", "CI", "RECORD_STATUS", "CREATED_BY", "CREATED_DATE", "LAST_UPDATED_BY", "LAST_UPDATED_DATE", "REV_NO", "REV_TEXT") AS 
  WITH MTH_COUNT AS (SELECT
      MONTHS_BETWEEN(MAX(TRUNC(end_date,'MONTH')), MIN(TRUNC(start_date,'MONTH'))) AS MTH, MIN(TRUNC(start_date,'MONTH')) MIN_DT
      FROM forecast WHERE class_name='FORECAST_PROD')
SELECT a.FORECAST_ID AS FORECAST_ID,
       a.OBJECT_ID AS OBJECT_ID,
       m1.MTH AS FROM_MONTH,
       m2.MTH AS TO_MONTH,
       a.VARIABLE_CODE AS VARIABLE_CODE,
       a.VARIABLE_NAME AS VARIABLE_NAME,
       a.SORT_ORDER AS SORT_ORDER,
       AVG(a.OIL) AS OIL,
       AVG(a.GAS) AS GAS,
       AVG(a.WAT) AS WAT,
       AVG(a.COND) AS COND,
       AVG(a.GL) AS GL,
       AVG(a.DL) AS DL,
       AVG(a.WI) AS WI,
       AVG(a.GI) AS GI,
       AVG(a.SI) AS SI,
       AVG(a.CI) AS CI,
       NULL AS RECORD_STATUS,
       NULL AS CREATED_BY,
       NULL AS CREATED_DATE,
       NULL AS LAST_UPDATED_BY,
       NULL AS LAST_UPDATED_DATE,
       NULL AS REV_NO,
       NULL AS REV_TEXT
FROM V_FCST_SUMM_VAR_DAY a,
     (SELECT ADD_MONTHS(MTH_COUNT.MIN_DT, LEVEL-1) AS MTH FROM CTRL_DB_VERSION, MTH_COUNT WHERE DB_VERSION = 1 CONNECT BY LEVEL <= MTH_COUNT.MTH+12) m1,
     (SELECT ADD_MONTHS(MTH_COUNT.MIN_DT, LEVEL-1) AS MTH FROM CTRL_DB_VERSION, MTH_COUNT WHERE DB_VERSION = 1 CONNECT BY LEVEL <= MTH_COUNT.MTH+12) m2
WHERE TRUNC(a.DAYTIME, 'MONTH') BETWEEN m1.MTH and m2.MTH
GROUP BY a.FORECAST_ID, a.OBJECT_ID, a.VARIABLE_CODE, a.VARIABLE_NAME, a.SORT_ORDER, m1.MTH, m2.MTH
ORDER BY a.SORT_ORDER