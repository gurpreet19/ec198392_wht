CREATE OR REPLACE FORCE EDITIONABLE VIEW "V_TRANS_INV_LI_PR_VAR_D_HI" ("CLASS_NAME", "OBJECT_ID", "OBJECT_CODE", "JN_DATETIME", "DAYTIME", "NAME", "END_DATE", "LINE_TAG", "EXEC_ORDER", "DIMENSION", "KEY_VAL", "TEXT", "TRANS_PROD_SET_ITEM_ID", "VAR_KEY2", "VAR_KEY", "TYPE", "COST_TYPE", "PARAM2", "PARAM", "PRODUCT_ID", "PRODUCT_CODE", "CONFIG_VARIABLE_ID", "CONFIG_VARIABLE_CODE", "CONFIG_VARIABLE_PARAM_ID", "CONFIG_VARIABLE_PARAM_CODE", "TRANS_PARAM_SOURCE_ID", "TRANS_PARAM_SOURCE_CODE", "PROD_STREAM_ID", "PROD_STREAM_CODE", "RECORD_STATUS", "CREATED_BY", "CREATED_DATE", "LAST_UPDATED_BY", "LAST_UPDATED_DATE", "REV_NO", "REV_TEXT", "APPROVAL_STATE", "APPROVAL_BY", "APPROVAL_DATE", "REC_ID") AS 
  (
----------------------------------------------------------------------------------------------------
-- File name: v_trans_inv_li_pr_var_dim_hist.sql
-- View name: v_trans_inv_li_pr_var_dim_hist
--
-- $Revision: 1.0 $
--
-- Purpose  : combine both Historical and Current version of records.
--
-- Modification history:
--9
-- Date       Whom       Change description:
-- ---------- ----       --------------------------------------------------------------------------------
-- 25.10.2016 hannnyii
----------------------------------------------------------------------------------------------------
    SELECT
'v_trans_inv_li_pr_var_dim_hi' AS CLASS_NAME,
V_TRANS_INV_LI_PR_VAR_DIM_H.OBJECT_ID AS OBJECT_ID,
o.OBJECT_CODE OBJECT_CODE,
V_TRANS_INV_LI_PR_VAR_DIM_H.JN_DATETIME AS JN_DATETIME,
V_TRANS_INV_LI_PR_VAR_DIM_H.DAYTIME AS DAYTIME,
V_TRANS_INV_LI_PR_VAR_DIM_H.NAME AS NAME,
V_TRANS_INV_LI_PR_VAR_DIM_H.END_DATE AS END_DATE,
V_TRANS_INV_LI_PR_VAR_DIM_H.LINE_TAG AS LINE_TAG,
V_TRANS_INV_LI_PR_VAR_DIM_H.VARIABLE_EXEC_ORDER AS EXEC_ORDER,
V_TRANS_INV_LI_PR_VAR_DIM_H.DIMENSION AS DIMENSION,
V_TRANS_INV_LI_PR_VAR_DIM_H.KEY AS KEY_VAL,
V_TRANS_INV_LI_PR_VAR_DIM_H.TEXT AS TEXT,
PRODUCT_ID ||'|'|| COST_TYPE AS TRANS_PROD_SET_ITEM_ID,
PROD_STREAM_ID ||'|'|| VARIABLE_EXEC_ORDER ||'|'||CONFIG_VARIABLE_ID||'|'||CONFIG_VARIABLE_PARAM_ID AS VAR_KEY2,
PROD_STREAM_ID ||'|'|| VARIABLE_EXEC_ORDER ||'|'||config_variable_id AS VAR_KEY,
ecdp_trans_inventory.FindVariableParamType(CONFIG_VARIABLE_param_id,oa.daytime) AS TYPE,
V_TRANS_INV_LI_PR_VAR_DIM_H.COST_TYPE AS COST_TYPE,
REPLACE(ecdp_trans_inventory.GetParameterObject(dimension,CONFIG_VARIABLE_ID,oa.daytime),'TRANS_PROD_SET_ITEM','PRODUCT') AS PARAM2,
ecdp_trans_inventory.GetParameterObject(dimension,CONFIG_VARIABLE_ID,oa.daytime) AS PARAM,
V_TRANS_INV_LI_PR_VAR_DIM_H.PRODUCT_ID AS PRODUCT_ID,
EC_PRODUCT.object_code(V_TRANS_INV_LI_PR_VAR_DIM_H.PRODUCT_ID) AS PRODUCT_CODE,
V_TRANS_INV_LI_PR_VAR_DIM_H.CONFIG_VARIABLE_ID AS CONFIG_VARIABLE_ID,
EC_CONFIG_VARIABLE.object_code(V_TRANS_INV_LI_PR_VAR_DIM_H.CONFIG_VARIABLE_ID) AS CONFIG_VARIABLE_CODE,
V_TRANS_INV_LI_PR_VAR_DIM_H.CONFIG_VARIABLE_PARAM_ID AS CONFIG_VARIABLE_PARAM_ID,
EC_CONFIG_VARIABLE_PARAM.object_code(V_TRANS_INV_LI_PR_VAR_DIM_H.CONFIG_VARIABLE_PARAM_ID) AS CONFIG_VARIABLE_PARAM_CODE,
V_TRANS_INV_LI_PR_VAR_DIM_H.TRANS_PARAM_SOURCE_ID AS TRANS_PARAM_SOURCE_ID,
EcDp_Objects.GetObjCode(V_TRANS_INV_LI_PR_VAR_DIM_H.TRANS_PARAM_SOURCE_ID) AS TRANS_PARAM_SOURCE_CODE,
V_TRANS_INV_LI_PR_VAR_DIM_H.PROD_STREAM_ID AS PROD_STREAM_ID,
EC_CONTRACT.object_code(V_TRANS_INV_LI_PR_VAR_DIM_H.PROD_STREAM_ID) AS PROD_STREAM_CODE,
V_TRANS_INV_LI_PR_VAR_DIM_H.RECORD_STATUS AS RECORD_STATUS,
V_TRANS_INV_LI_PR_VAR_DIM_H.CREATED_BY AS CREATED_BY,
V_TRANS_INV_LI_PR_VAR_DIM_H.CREATED_DATE AS CREATED_DATE,
V_TRANS_INV_LI_PR_VAR_DIM_H.LAST_UPDATED_BY AS LAST_UPDATED_BY,
V_TRANS_INV_LI_PR_VAR_DIM_H.LAST_UPDATED_DATE AS LAST_UPDATED_DATE,
V_TRANS_INV_LI_PR_VAR_DIM_H.REV_NO AS REV_NO,
V_TRANS_INV_LI_PR_VAR_DIM_H.REV_TEXT AS REV_TEXT,
V_TRANS_INV_LI_PR_VAR_DIM_H.APPROVAL_STATE AS APPROVAL_STATE,
V_TRANS_INV_LI_PR_VAR_DIM_H.APPROVAL_BY AS APPROVAL_BY,
V_TRANS_INV_LI_PR_VAR_DIM_H.APPROVAL_DATE AS APPROVAL_DATE,
V_TRANS_INV_LI_PR_VAR_DIM_H.REC_ID AS REC_ID
FROM V_TRANS_INV_LI_PR_VAR_DIM_H
, TRANS_INVENTORY_VERSION oa, TRANS_INVENTORY o
WHERE V_TRANS_INV_LI_PR_VAR_DIM_H.object_id = oa.object_id
AND oa.object_id = o.object_id
AND V_TRANS_INV_LI_PR_VAR_DIM_H.daytime >= oa.daytime
AND (oa.end_date is NULL OR V_TRANS_INV_LI_PR_VAR_DIM_H.daytime < oa.end_date)
AND PRODUCT_ID!='MESSAGE'
)