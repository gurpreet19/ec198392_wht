CREATE OR REPLACE FORCE EDITIONABLE VIEW "V_TRACING_REPORT" ("HEADING", "PROCESS", "DATA_ENTITY_CAT", "SORT_ORDER", "DATA_ENTITY_DAYTIME", "PERIOD", "DATA_ENTITY_ID", "DATA_ENTITY_TYPE", "PROPERTY_OBJ_CODE", "PROPERTY_OBJ_ID", "PARENT_PROJECT_OBJ_CODE", "PARENT_PROJECT_OBJ_ID", "PROJECT_OBJ_CODE", "PROJECT_OBJ_ID", "DEP_STATUS", "BOX_TEXT_1", "BOX_TEXT_2", "BOX_TEXT_3", "BOX_TEXT_4", "BOX_TEXT_5", "BOX_TEXT_6", "BOX_TEXT_COLOR_1", "BOX_TEXT_COLOR_2", "BOX_TEXT_COLOR_3", "BOX_TEXT_COLOR_4", "BOX_TEXT_COLOR_5", "BOX_TEXT_COLOR_6", "TOP_TEXT_1", "TOP_TEXT_2", "TOP_TEXT_3", "TOP_TEXT_4", "TOP_TEXT_5", "TOP_TEXT_6", "TOP_TEXT_7", "TOP_TEXT_8", "TOP_TEXT_9", "TOP_TEXT_10", "TOP_TEXT_11", "TOP_TEXT_12", "TOP_TEXT_COLOR_1", "TOP_TEXT_COLOR_2", "TOP_TEXT_COLOR_3", "TOP_TEXT_COLOR_4", "TOP_TEXT_COLOR_5", "TOP_TEXT_COLOR_6", "TOP_TEXT_COLOR_7", "TOP_TEXT_COLOR_8", "TOP_TEXT_COLOR_9", "TOP_TEXT_COLOR_10", "TOP_TEXT_COLOR_11", "TOP_TEXT_COLOR_12", "BOTTOM_TEXT_1", "BOTTOM_TEXT_2", "BOTTOM_TEXT_3", "BOTTOM_TEXT_4", "BOTTOM_TEXT_5", "BOTTOM_TEXT_6", "BOTTOM_TEXT_7", "BOTTOM_TEXT_8", "BOTTOM_TEXT_9", "BOTTOM_TEXT_10", "BOTTOM_TEXT_11", "BOTTOM_TEXT_12", "BOTTOM_TEXT_COLOR_1", "BOTTOM_TEXT_COLOR_2", "BOTTOM_TEXT_COLOR_3", "BOTTOM_TEXT_COLOR_4", "BOTTOM_TEXT_COLOR_5", "BOTTOM_TEXT_COLOR_6", "BOTTOM_TEXT_COLOR_7", "BOTTOM_TEXT_COLOR_8", "BOTTOM_TEXT_COLOR_9", "BOTTOM_TEXT_COLOR_10", "BOTTOM_TEXT_COLOR_11", "BOTTOM_TEXT_COLOR_12", "ICON_1", "ICON_2", "ICON_3", "ICON_4", "ICON_5", "ACTUAL_ACCRUAL_CODE", "FORECAST_IND", "DEPRECATED_IND", "RECORD_STATUS", "CREATED_BY", "CREATED_DATE", "LAST_UPDATED_BY", "LAST_UPDATED_DATE", "REV_NO", "REV_TEXT", "APPROVAL_BY", "APPROVAL_DATE", "APPROVAL_STATE", "REC_ID") AS 
  SELECT
    'Reports'                                                                                                                   AS HEADING,
    NULL                                                                                                                        AS PROCESS,
    'REPORT'                                                                                                                    AS DATA_ENTITY_CAT,
    7                                                                                                                           AS SORT_ORDER,
    x.daytime                                                                                                                   AS DATA_ENTITY_DAYTIME,
    x.daytime                                                                                                                   AS PERIOD,
    dfd.reference_id                                                                                                            AS DATA_ENTITY_ID,
    dfd.type                                                                                                                    AS DATA_ENTITY_TYPE,
    ec_contract_area.object_code(ec_contract_version.contract_area_id(x.object_id,x.daytime, '<=' ))                            AS PROPERTY_OBJ_CODE,
    ec_contract_version.contract_area_id(x.object_id,x.daytime, '<=' )                                                          AS PROPERTY_OBJ_ID,
    ec_contract.object_code(ec_contract_version.parent_contract_id(x.object_id, x.daytime, '<='))                               AS PARENT_PROJECT_OBJ_CODE,
    ec_contract_version.parent_contract_id(x.object_id, x.daytime, '<=')                                                        AS PARENT_PROJECT_OBJ_ID,
    ec_contract.object_code(x.object_id)                                                                                        AS PROJECT_OBJ_CODE,
    x.object_id                                                                                                                 AS PROJECT_OBJ_ID,
    ec_prosty_codes.code_text(nvl(ec_report.accept_status(x.report_no),'P'), 'TRACING_STATUS')                                  AS DEP_STATUS,
    'Report ID: ' || to_char(x.report_no)                                                                                       AS BOX_TEXT_1,
    'Project: '|| ec_contract_version.name(x.object_id , x.daytime, '<=')                                                       AS BOX_TEXT_2,
    'Report: '|| ec_report.report_runable_name(x.report_no)                                                                     AS BOX_TEXT_3,
    'Created by: '|| nvl(ec_t_basis_user.given_name(x.created_by),x.created_by) ||' '|| ec_t_basis_user.surname(x.created_by)   AS BOX_TEXT_4,
    NULL                                                                                                                        AS BOX_TEXT_5,
    NULL                                                                                                                        AS BOX_TEXT_6,
    NULL                                                                                                                        AS BOX_TEXT_COLOR_1,
    NULL                                                                                                                        AS BOX_TEXT_COLOR_2,
    NULL                                                                                                                        AS BOX_TEXT_COLOR_3,
    NULL                                                                                                                        AS BOX_TEXT_COLOR_4,
    NULL                                                                                                                        AS BOX_TEXT_COLOR_5,
    NULL                                                                                                                        AS BOX_TEXT_COLOR_6,
    NULL                                                                                                                        AS TOP_TEXT_1,
    NULL                                                                                                                        AS TOP_TEXT_2,
    NULL                                                                                                                        AS TOP_TEXT_3,
    NULL                                                                                                                        AS TOP_TEXT_4,
    NULL                                                                                                                        AS TOP_TEXT_5,
    NULL                                                                                                                        AS TOP_TEXT_6,
    NULL                                                                                                                        AS TOP_TEXT_7,
    NULL                                                                                                                        AS TOP_TEXT_8,
    NULL                                                                                                                        AS TOP_TEXT_9,
    NULL                                                                                                                        AS TOP_TEXT_10,
    NULL                                                                                                                        AS TOP_TEXT_11,
    NULL                                                                                                                        AS TOP_TEXT_12,
    NULL                                                                                                                        AS TOP_TEXT_COLOR_1,
    NULL                                                                                                                        AS TOP_TEXT_COLOR_2,
    NULL                                                                                                                        AS TOP_TEXT_COLOR_3,
    NULL                                                                                                                        AS TOP_TEXT_COLOR_4,
    NULL                                                                                                                        AS TOP_TEXT_COLOR_5,
    NULL                                                                                                                        AS TOP_TEXT_COLOR_6,
    NULL                                                                                                                        AS TOP_TEXT_COLOR_7,
    NULL                                                                                                                        AS TOP_TEXT_COLOR_8,
    NULL                                                                                                                        AS TOP_TEXT_COLOR_9,
    NULL                                                                                                                        AS TOP_TEXT_COLOR_10,
    NULL                                                                                                                        AS TOP_TEXT_COLOR_11,
    NULL                                                                                                                        AS TOP_TEXT_COLOR_12,
    NULL                                                                                                                        AS BOTTOM_TEXT_1,
    NULL                                                                                                                        AS BOTTOM_TEXT_2,
    NULL                                                                                                                        AS BOTTOM_TEXT_3,
    NULL                                                                                                                        AS BOTTOM_TEXT_4,
    NULL                                                                                                                        AS BOTTOM_TEXT_5,
    NULL                                                                                                                        AS BOTTOM_TEXT_6,
    NULL                                                                                                                        AS BOTTOM_TEXT_7,
    NULL                                                                                                                        AS BOTTOM_TEXT_8,
    NULL                                                                                                                        AS BOTTOM_TEXT_9,
    NULL                                                                                                                        AS BOTTOM_TEXT_10,
    NULL                                                                                                                        AS BOTTOM_TEXT_11,
    NULL                                                                                                                        AS BOTTOM_TEXT_12,
    NULL                                                                                                                        AS BOTTOM_TEXT_COLOR_1,
    NULL                                                                                                                        AS BOTTOM_TEXT_COLOR_2,
    NULL                                                                                                                        AS BOTTOM_TEXT_COLOR_3,
    NULL                                                                                                                        AS BOTTOM_TEXT_COLOR_4,
    NULL                                                                                                                        AS BOTTOM_TEXT_COLOR_5,
    NULL                                                                                                                        AS BOTTOM_TEXT_COLOR_6,
    NULL                                                                                                                        AS BOTTOM_TEXT_COLOR_7,
    NULL                                                                                                                        AS BOTTOM_TEXT_COLOR_8,
    NULL                                                                                                                        AS BOTTOM_TEXT_COLOR_9,
    NULL                                                                                                                        AS BOTTOM_TEXT_COLOR_10,
    NULL                                                                                                                        AS BOTTOM_TEXT_COLOR_11,
    NULL                                                                                                                        AS BOTTOM_TEXT_COLOR_12,
    'tracing/OK.png'                                                                                                            AS ICON_1,
    'tracing/' || x.record_status || '.png'                                                                                     AS ICON_2,
    DECODE(ecdp_visual_tracing.GetForwardReference(dfd.reference_id, 'REPORT'),'true','tracing/LOCK.png','')                    AS ICON_3,
    DECODE(ecdp_visual_tracing.GetNotesReference(to_char(x.report_no), 'REPORT'),'true','tracing/NOTES.png','')                 AS ICON_4,
    NULL                                                                                                                        AS ICON_5,
    ecdp_visual_tracing.GetReportActualAccrual(x.document_key, x.report_no)                                                     AS ACTUAL_ACCRUAL_CODE,
    'N'                                                                                                                         AS FORECAST_IND,
    DECODE(ec_dataset_flow_report.status(x.id),'D','Y','N')                                                                     AS DEPRECATED_IND,
    x.record_status                                                                                                             AS RECORD_STATUS,
    x.created_by                                                                                                                AS CREATED_BY,
    x.created_date                                                                                                              AS CREATED_DATE,
    x.last_updated_by                                                                                                           AS LAST_UPDATED_BY,
    x.last_updated_date                                                                                                         AS LAST_UPDATED_DATE,
    x.rev_no                                                                                                                    AS REV_NO,
    x.rev_text                                                                                                                  AS REV_TEXT,
    x.approval_by                                                                                                               AS APPROVAL_BY,
    x.approval_date                                                                                                             AS APPROVAL_DATE,
    x.approval_state                                                                                                            AS APPROVAL_STATE,
    x.rec_id                                                                                                                    AS REC_ID
 FROM dataset_flow_report   x,
      dataset_flow_document dfd
WHERE to_char(x.report_no)          = to_char(dfd.reference_id)
  AND ec_report.status(x.report_no) = 'GENERATED'
  AND dfd.type                      = 'REPORT'
ORDER BY x.daytime, x.created_date