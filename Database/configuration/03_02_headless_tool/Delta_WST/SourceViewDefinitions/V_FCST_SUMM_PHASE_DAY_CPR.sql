CREATE OR REPLACE FORCE EDITIONABLE VIEW "V_FCST_SUMM_PHASE_DAY_CPR" ("FORECAST_ID_1", "OBJECT_ID_1", "FORECAST_ID_2", "OBJECT_ID_2", "DAYTIME", "SORT_ORDER", "PHASE_CODE", "PHASE_NAME", "POT_UNCONSTR_1", "CONSTR_1", "POT_CONSTR_1", "S1P_SHORTFALL_1", "S1U_SHORTFALL_1", "S2_SHORTFALL_1", "INT_CONSUMPT_1", "LOSSES_1", "COMPENSATION_1", "AVAIL_EXPORT_1", "INJ_1", "POT_UNCONSTR_2", "CONSTR_2", "POT_CONSTR_2", "S1P_SHORTFALL_2", "S1U_SHORTFALL_2", "S2_SHORTFALL_2", "INT_CONSUMPT_2", "LOSSES_2", "COMPENSATION_2", "AVAIL_EXPORT_2", "INJ_2", "POT_UNCONSTR_DIFF", "CONSTR_DIFF", "POT_CONSTR_DIFF", "S1P_SHORTFALL_DIFF", "S1U_SHORTFALL_DIFF", "S2_SHORTFALL_DIFF", "INT_CONSUMPT_DIFF", "LOSSES_DIFF", "COMPENSATION_DIFF", "AVAIL_EXPORT_DIFF", "INJ_DIFF", "RECORD_STATUS", "CREATED_BY", "CREATED_DATE", "LAST_UPDATED_BY", "LAST_UPDATED_DATE", "REV_NO", "REV_TEXT") AS 
  SELECT s1.FORECAST_ID AS FORECAST_ID_1,
       s1.OBJECT_ID AS OBJECT_ID_1,
       s2.FORECAST_ID AS FORECAST_ID_2,
       s2.OBJECT_ID AS OBJECT_ID_2,
       NVL(s1.MONTH_1, s2.MONTH_2 )AS DAYTIME,
       NVL(s1.SORT_ORDER_1,s2.SORT_ORDER_2) AS SORT_ORDER,
       NVL(s1.PHASE_CODE_1,s2.PHASE_CODE_2) AS PHASE_CODE,
       NVL(s1.PHASE_NAME_1,s2.PHASE_NAME_2) AS PHASE_NAME,
       s1.POT_UNCONSTR_1 AS POT_UNCONSTR_1,
       s1.CONSTR_1 AS CONSTR_1,
       s1.POT_CONSTR_1 AS POT_CONSTR_1,
       s1.S1P_SHORTFALL_1 AS S1P_SHORTFALL_1,
       s1.S1U_SHORTFALL_1 AS S1U_SHORTFALL_1,
       s1.S2_SHORTFALL_1 AS S2_SHORTFALL_1,
       s1.INT_CONSUMPT_1 AS INT_CONSUMPT_1,
       s1.LOSSES_1 AS LOSSES_1,
       s1.COMPENSATION_1 AS COMPENSATION_1,
       s1.AVAIL_EXPORT_1 AS AVAIL_EXPORT_1,
       s1.INJ_1 AS INJ_1,
       s2.POT_UNCONSTR_2 AS POT_UNCONSTR_2,
       s2.CONSTR_2 AS CONSTR_2,
       s2.POT_CONSTR_2 AS POT_CONSTR_2,
       s2.S1P_SHORTFALL_2 AS S1P_SHORTFALL_2,
       s2.S1U_SHORTFALL_2 AS S1U_SHORTFALL_2,
       s2.S2_SHORTFALL_2 AS S2_SHORTFALL_2,
       s2.INT_CONSUMPT_2 AS INT_CONSUMPT_2,
       s2.LOSSES_2 AS LOSSES_2,
       s2.COMPENSATION_2 AS COMPENSATION_2,
       s2.AVAIL_EXPORT_2 AS AVAIL_EXPORT_2,
       s2.INJ_2 AS INJ_2,
       COALESCE(s2.POT_UNCONSTR_2-s1.POT_UNCONSTR_1,s2.POT_UNCONSTR_2,-s1.POT_UNCONSTR_1) AS   POT_UNCONSTR_DIFF,
       COALESCE(s2.CONSTR_2-s1.CONSTR_1,s2.CONSTR_2,-s1.CONSTR_1) AS   CONSTR_DIFF,
       COALESCE(s2.POT_CONSTR_2-s1.POT_CONSTR_1,s2.POT_CONSTR_2,-s1.POT_CONSTR_1) AS   POT_CONSTR_DIFF,
       COALESCE(s2.S1P_SHORTFALL_2-s1.S1P_SHORTFALL_1,s2.S1P_SHORTFALL_2,-s1.S1P_SHORTFALL_1) AS   S1P_SHORTFALL_DIFF,
       COALESCE(s2.S1U_SHORTFALL_2-s1.S1U_SHORTFALL_1,s2.S1U_SHORTFALL_2,-s1.S1U_SHORTFALL_1) AS   S1U_SHORTFALL_DIFF,
       COALESCE(s2.S2_SHORTFALL_2-s1.S2_SHORTFALL_1,s2.S2_SHORTFALL_2,-s1.S2_SHORTFALL_1) AS   S2_SHORTFALL_DIFF,
       COALESCE(s2.INT_CONSUMPT_2-s1.INT_CONSUMPT_1,s2.INT_CONSUMPT_2,-s1.INT_CONSUMPT_1) AS   INT_CONSUMPT_DIFF,
       COALESCE(s2.LOSSES_2-s1.LOSSES_1,s2.LOSSES_2,-s1.LOSSES_1) AS   LOSSES_DIFF,
       COALESCE(s2.COMPENSATION_2-s1.COMPENSATION_1,s2.COMPENSATION_2,-s1.COMPENSATION_1) AS   COMPENSATION_DIFF,
       COALESCE(s2.AVAIL_EXPORT_2-s1.AVAIL_EXPORT_1,s2.AVAIL_EXPORT_2,-s1.AVAIL_EXPORT_1) AS   AVAIL_EXPORT_DIFF,
       COALESCE(s2.INJ_2-s1.INJ_1,s2.INJ_2,-s1.INJ_1) AS   INJ_DIFF,
       NULL AS RECORD_STATUS,
       NULL AS CREATED_BY,
       NULL AS CREATED_DATE,
       NULL AS LAST_UPDATED_BY,
       NULL AS LAST_UPDATED_DATE,
       NULL AS REV_NO,
       NULL AS REV_TEXT
FROM (SELECT FORECAST_ID, OBJECT_ID, MONTH AS MONTH_1, PHASE_CODE AS PHASE_CODE_1, PHASE_NAME AS PHASE_NAME_1, SORT_ORDER AS SORT_ORDER_1, POT_UNCONSTR AS POT_UNCONSTR_1, CONSTR AS CONSTR_1, POT_CONSTR AS POT_CONSTR_1, S1P_SHORTFALL AS S1P_SHORTFALL_1, S1U_SHORTFALL AS S1U_SHORTFALL_1, S2_SHORTFALL AS S2_SHORTFALL_1, INT_CONSUMPT AS INT_CONSUMPT_1, LOSSES AS LOSSES_1, COMPENSATION AS COMPENSATION_1, AVAIL_EXPORT AS AVAIL_EXPORT_1,INJ AS INJ_1
      FROM TABLE(EcBp_Forecast_Prod.getGrpFcstPhaseDataDay('SCENARIO_1'))) s1
FULL OUTER JOIN
     (SELECT FORECAST_ID, OBJECT_ID, MONTH AS MONTH_2, PHASE_CODE AS PHASE_CODE_2, PHASE_NAME AS PHASE_NAME_2, SORT_ORDER AS SORT_ORDER_2, POT_UNCONSTR AS POT_UNCONSTR_2, CONSTR AS CONSTR_2, POT_CONSTR AS POT_CONSTR_2, S1P_SHORTFALL AS S1P_SHORTFALL_2, S1U_SHORTFALL AS S1U_SHORTFALL_2, S2_SHORTFALL AS S2_SHORTFALL_2, INT_CONSUMPT AS INT_CONSUMPT_2, LOSSES AS LOSSES_2, COMPENSATION AS COMPENSATION_2, AVAIL_EXPORT AS AVAIL_EXPORT_2,INJ AS INJ_2
      FROM TABLE(EcBp_Forecast_Prod.getGrpFcstPhaseDataDay('SCENARIO_2'))) s2
ON  s1.PHASE_CODE_1 = s2.PHASE_CODE_2
AND s1.MONTH_1 = s2.month_2
ORDER BY SORT_ORDER