CREATE OR REPLACE TRIGGER "IUD_V_TASK_LIST" 
 INSTEAD OF INSERT OR UPDATE OR DELETE ON v_task_list
FOR EACH ROW
-- $Revision: 1.4 $

BEGIN

  IF :NEW.TASK_TYPE <> 'APPROVAL' THEN

    IF INSERTING THEN

      INSERT INTO TASK(TASK_NO,TASK_TYPE,TASK_PROCESS_ID,SORT_ORDER,TASK_DESCRIPTION,BUSINESS_FUNCTION_NO,TASK_DUE_DATE,
                       TASK_STATUS,RESPONSIBLE,COMMENTS,RECORD_STATUS,CREATED_BY,CREATED_DATE,LAST_UPDATED_BY,
                       LAST_UPDATED_DATE,REV_NO,REV_TEXT,APPROVAL_BY,APPROVAL_DATE,APPROVAL_STATE,REC_ID)
      values(:NEW.TASK_NO,:NEW.TASK_TYPE,:NEW.TASK_PROCESS_ID,:NEW.SORT_ORDER,:NEW.DESCRIPTION,:NEW.BUSINESS_FUNCTION_NO,:NEW.TASK_DUE_DATE,
             :NEW.TASK_STATUS,:NEW.RESPONSIBLE,:NEW.COMMENTS,:NEW.RECORD_STATUS,:NEW.CREATED_BY,:NEW.CREATED_DATE,:NEW.LAST_UPDATED_BY,
             :NEW.LAST_UPDATED_DATE,:NEW.REV_NO,:NEW.REV_TEXT,:NEW.APPROVAL_BY,:NEW.APPROVAL_DATE,:NEW.APPROVAL_STATE,:NEW.REC_ID
            );

    ELSIF UPDATING THEN

     UPDATE TASK SET
      TASK_NO =           :new.TASK_NO
      ,TASK_TYPE =         :new.TASK_TYPE
      ,TASK_PROCESS_ID =   :new.TASK_PROCESS_ID
      ,SORT_ORDER=         :new.SORT_ORDER
      ,TASK_DESCRIPTION=   :new.DESCRIPTION
      ,BUSINESS_FUNCTION_NO = :new.BUSINESS_FUNCTION_NO
      ,TASK_DUE_DATE =     :new.TASK_DUE_DATE
      ,TASK_STATUS =       :new.TASK_STATUS
      ,RESPONSIBLE =       :new.RESPONSIBLE
      ,COMMENTS =          :new.COMMENTS
      ,RECORD_STATUS =     :new.RECORD_STATUS
      ,CREATED_BY  =       :new.CREATED_BY
      ,CREATED_DATE =      :new.CREATED_DATE
      ,LAST_UPDATED_BY =   :new.LAST_UPDATED_BY
      ,LAST_UPDATED_DATE=  :new.LAST_UPDATED_DATE
      ,REV_NO=             :new.REV_NO
      ,REV_TEXT=           :new.REV_TEXT
      ,APPROVAL_BY=        :new.APPROVAL_BY
      ,APPROVAL_DATE=      :new.APPROVAL_DATE
      ,APPROVAL_STATE=     :new.APPROVAL_STATE
      ,REC_ID=             :new.REC_ID
     where TASK_NO = :old.TASK_NO;


    ELSIF DELETING THEN

      DELETE FROM TASK WHERE task_no = :old.task_no;


    END IF;

  ELSE

    Raise_Application_Error(-20631,'Update on Approval task is not allowed');

  END IF;
END;

