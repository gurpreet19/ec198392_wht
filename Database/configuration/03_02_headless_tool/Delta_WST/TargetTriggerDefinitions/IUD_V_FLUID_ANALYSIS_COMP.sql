CREATE OR REPLACE TRIGGER "IUD_V_FLUID_ANALYSIS_COMP" 
 INSTEAD OF INSERT OR UPDATE OR DELETE ON v_fluid_analysis_comp
FOR EACH ROW
-- $Revision: 1.12.2.2 $
-- $Author: HAK
DECLARE
-- Variables for storing temporary values
ln_analysis_no NUMBER;
v_count NUMBER:=0;

BEGIN

-- INSERT BLOCK
IF INSERTING THEN

  -- Does an analysis (entry in object_fluid_analysis) already exist?
   SELECT max(ofa.analysis_no) INTO ln_analysis_no
     FROM object_fluid_analysis ofa
    WHERE ofa.object_id = :New.object_id
      AND ofa.daytime = :New.daytime
      AND ofa.analysis_type = :New.analysis_type
      AND ofa.sampling_method = :New.sampling_method
      AND ofa.phase = :New.phase;

  -- If no, create an analysis
  IF ln_analysis_no IS NULL THEN
      INSERT INTO v_object_fluid_analysis (
      analysis_no,
      object_id,
      object_class_name,
      daytime,
      analysis_type,
      sampling_method,
      phase,
      valid_from_date,
      production_day,
      analysis_status,
      sample_press,
      sample_temp,
      gas_density,
      oil_density,
      gross_liq_density,
      density_obs,
      sp_grav,
      api,
      shrinkage_factor,
      solution_gor,
      bs_w,
      bs_w_wt,
      cnpl_mol_wt,
      cnpl_sp_grav,
      cnpl_density,
      mw_mix,
      sg_mix,
      sulfur_wt,
      gcv,
      gcv_flash,
      gcv_flash_press,
      gcv_press,
      ncv,
      gcr,
      wdp,
      rvp,
      h2s,
      co2,
      sand,
      salt,
      emulsion,
      emulsion_frac,
      emulsion_fact,
      scale_inhib,
      wax_content,
      critical_press,
      critical_temp,
      laboratory,
      lab_ref_no,
      sampled_by,
      sampled_date,
      oil_in_water,
      o2,
      chlorine,
      aluminium,
      barium,
      bicarbonate,
      boron,
      calcium,
      carbonate,
      chloride,
      hydroxide,
      iron,
      iron_total,
      lithium,
      magnesium,
      organic_acid,
      potassium,
      silicon,
      sodium,
      strontium,
      sulfate,
      phosphorus,
      cnpl_gcv,
      cnpl_api,
      vapour,
      salinity,
      flash_gas_factor,
      oil_in_water_content,
      butanoate,
      diss_solids,
      ethanoate,
      hexanoate,
      methanoate,
      pentanoate,
      ph,
      propionate,
      resistivity,
      sulfate_2,
      susp_solids,
      tot_alkalinity,
      sampling_point,
      fluid_state,
      check_unique,
      component_set,
      comments,
      value_1,
      value_2,
      value_3,
      value_4,
      value_5,
      value_6,
      value_7,
      value_8,
      value_9,
      value_10,
      value_11,
      value_12,
      value_13,
      value_14,
      value_15,
      value_16,
      value_17,
      value_18,
      value_19,
      value_20,
      value_21,
      value_22,
      value_23,
      value_24,
      value_25,
      value_26,
      value_27,
      value_28,
      value_29,
      value_30,
      value_31,
      value_32,
      value_33,
      value_34,
      value_35,
      value_36,
      value_37,
      value_38,
      value_39,
      value_40,
      value_41,
      value_42,
      value_43,
      value_44,
      value_45,
      value_46,
      value_47,
      text_1,
      text_2,
      text_3,
      text_4,
      text_5,
      text_6,
      text_7,
      text_8,
      text_9,
      text_10,
      text_11,
      text_12,
      text_13,
      text_14,
      text_15,
      text_16,
      text_17,
      text_18,
      text_19,
      text_20,
      text_21,
      text_22,
      text_23,
      text_24,
      text_25,
      text_26,
      text_27,
      text_28,
      text_29,
      text_30,
      text_31,
      text_32,
      text_33,
      text_34,
      text_35,
      text_36,
      text_37,
      text_38,
      text_39,
      text_40,
      text_41,
      text_42,
      date_1,
      date_2,
      date_3,
      date_4,
      date_5,
      date_6,
      date_7,
      date_8,
      date_9,
      date_10,
      date_11,
      record_status,
      created_by,
      created_date,
      last_updated_by,
      last_updated_date,
      rev_no,
      rev_text
      ) VALUES (
      :New.analysis_no,
      :New.object_id,
      EcDp_Objects.getObjClassName(:New.object_id),
      :New.daytime,
      :New.analysis_type,
      :New.sampling_method,
      :New.phase,
      :New.valid_from_date,
      :New.production_day,
      NVL(:New.analysis_status,'NEW'),
      :New.sample_press,
      :New.sample_temp,
      :New.gas_density,
      :New.oil_density,
      :New.gross_liq_density,
      :New.density_obs,
      :New.sp_grav,
      :New.api,
      :New.shrinkage_factor,
      :New.solution_gor,
      :New.bs_w,
      :New.bs_w_wt,
      :New.cnpl_mol_wt,
      :New.cnpl_sp_grav,
      :New.cnpl_density,
      :New.mw_mix,
      :New.sg_mix,
      :New.sulfur_wt,
      :New.gcv,
      :New.gcv_flash,
      :New.gcv_flash_press,
      :New.gcv_press,
      :New.ncv,
      :New.gcr,
      :New.wdp,
      :New.rvp,
      :New.h2s,
      :New.co2,
      :New.sand,
      :New.salt,
      :New.emulsion,
      :New.emulsion_frac,
      :New.emulsion_fact,
      :New.scale_inhib,
      :New.wax_content,
      :New.critical_press,
      :New.critical_temp,
      :New.laboratory,
      :New.lab_ref_no,
      :New.sampled_by,
      :New.sampled_date,
      :New.oil_in_water,
      :New.o2,
      :New.chlorine,
      :New.aluminium,
      :New.barium,
      :New.bicarbonate,
      :New.boron,
      :New.calcium,
      :New.carbonate,
      :New.chloride,
      :New.hydroxide,
      :New.iron,
      :New.iron_total,
      :New.lithium,
      :New.magnesium,
      :New.organic_acid,
      :New.potassium,
      :New.silicon,
      :New.sodium,
      :New.strontium,
      :New.sulfate,
      :New.phosphorus,
      :New.cnpl_gcv,
      :New.cnpl_api,
      :New.vapour,
      :New.salinity,
      :New.flash_gas_factor,
      :New.oil_in_water_content,
      :New.butanoate,
      :New.diss_solids,
      :New.ethanoate,
      :New.hexanoate,
      :New.methanoate,
      :New.pentanoate,
      :New.ph,
      :New.propionate,
      :New.resistivity,
      :New.sulfate_2,
      :New.susp_solids,
      :New.tot_alkalinity,
      :New.sampling_point,
      :New.fluid_state,
      :New.check_unique,
      :NEW.component_set,
      :New.comments,
      :New.ofa_value_1,
      :New.ofa_value_2,
      :New.ofa_value_3,
      :New.ofa_value_4,
      :New.ofa_value_5,
      :New.ofa_value_6,
      :New.ofa_value_7,
      :New.ofa_value_8,
      :New.ofa_value_9,
      :New.ofa_value_10,
      :New.ofa_value_11,
      :New.ofa_value_12,
      :New.ofa_value_13,
      :New.ofa_value_14,
      :New.ofa_value_15,
      :New.ofa_value_16,
      :New.ofa_value_17,
      :New.ofa_value_18,
      :New.ofa_value_19,
      :New.ofa_value_20,
      :New.ofa_value_21,
      :New.ofa_value_22,
      :New.ofa_value_23,
      :New.ofa_value_24,
      :New.ofa_value_25,
      :New.ofa_value_26,
      :New.ofa_value_27,
      :New.ofa_value_28,
      :New.ofa_value_29,
      :New.ofa_value_30,
      :New.ofa_value_31,
      :New.ofa_value_32,
      :New.ofa_value_33,
      :New.ofa_value_34,
      :New.ofa_value_35,
      :New.ofa_value_36,
      :New.ofa_value_37,
      :New.ofa_value_38,
      :New.ofa_value_39,
      :New.ofa_value_40,
      :New.ofa_value_41,
      :New.ofa_value_42,
      :New.ofa_value_43,
      :New.ofa_value_44,
      :New.ofa_value_45,
      :New.ofa_value_46,
      :New.ofa_value_47,
      :New.ofa_text_1,
      :New.ofa_text_2,
      :New.ofa_text_3,
      :New.ofa_text_4,
      :New.ofa_text_5,
      :New.ofa_text_6,
      :New.ofa_text_7,
      :New.ofa_text_8,
      :New.ofa_text_9,
      :New.ofa_text_10,
      :New.ofa_text_11,
      :New.ofa_text_12,
      :New.ofa_text_13,
      :New.ofa_text_14,
      :New.ofa_text_15,
      :New.ofa_text_16,
      :New.ofa_text_17,
      :New.ofa_text_18,
      :New.ofa_text_19,
      :New.ofa_text_20,
      :New.ofa_text_21,
      :New.ofa_text_22,
      :New.ofa_text_23,
      :New.ofa_text_24,
      :New.ofa_text_25,
      :New.ofa_text_26,
      :New.ofa_text_27,
      :New.ofa_text_28,
      :New.ofa_text_29,
      :New.ofa_text_30,
      :New.ofa_text_31,
      :New.ofa_text_32,
      :New.ofa_text_33,
      :New.ofa_text_34,
      :New.ofa_text_35,
      :New.ofa_text_36,
      :New.ofa_text_37,
      :New.ofa_text_38,
      :New.ofa_text_39,
      :New.ofa_text_40,
      :New.ofa_text_41,
      :New.ofa_text_42,
      :New.date_1,
      :New.date_2,
      :New.date_3,
      :New.date_4,
      :New.date_5,
      :New.date_6,
      :New.date_7,
      :New.date_8,
      :New.date_9,
      :New.date_10,
      :New.date_11,
      :New.record_status,
      :New.created_by,
      :New.created_date,
      :New.last_updated_by,
      :New.last_updated_date,
      :New.rev_no,
      :New.rev_text
      );

   SELECT max(ofa.analysis_no) INTO ln_analysis_no
     FROM object_fluid_analysis ofa
    WHERE ofa.object_id = :New.object_id
      AND ofa.daytime = :New.daytime
      AND ofa.analysis_type = :New.analysis_type
      AND ofa.sampling_method = :New.sampling_method
      AND ofa.phase = :New.phase;

  	END IF;

  -- Insert component analysis entry
    INSERT INTO fluid_analysis_component (
    analysis_no,
    component_no,
    wt_pct,
    mol_pct,
    mol_wt,
    density,
    vol_pct,
    energy_pct,
    meas_mol_wt,
    meas_specific_gravity,
    value_1,
    value_2,
    value_3,
    value_4,
    value_5,
    value_6,
    value_7,
    value_8,
    value_9,
    value_10,
    text_1,
    text_2,
    text_3,
    text_4,
     record_status,
      created_by,
      created_date,
      last_updated_by,
      last_updated_date,
      rev_no,
      rev_text
    ) VALUES (
    ln_analysis_no,
    :New.component_no,
    :New.wt_pct,
    :New.mol_pct,
    :New.mol_wt,
    :New.density,
    :New.vol_pct,
    :New.energy_pct,
    :New.MEAS_MOL_WT,
    :New.MEAS_SPECIFIC_GRAVITY,
    :New.value_1,
    :New.value_2,
    :New.value_3,
    :New.value_4,
    :New.value_5,
    :New.value_6,
    :New.value_7,
    :New.value_8,
    :New.value_9,
    :New.value_10,
    :New.text_1,
    :New.text_2,
    :New.text_3,
    :New.text_4,
    :New.record_status,
      :New.created_by,
      :New.created_date,
      :New.last_updated_by,
      :New.last_updated_date,
      :New.rev_no,
      :New.rev_text
    );
END IF;

-- UPDATE BLOCK
IF UPDATING THEN
   -- Get analysis_no from database
    SELECT max(ofa.analysis_no)
    INTO ln_analysis_no
    FROM object_fluid_analysis ofa
    WHERE ofa.object_id = :Old.object_id
    AND ofa.daytime = :Old.daytime
    AND ofa.analysis_type = :Old.analysis_type
    AND ofa.sampling_method = :Old.sampling_method
    AND ofa.phase = :Old.phase;

   -- Update object_fluid_analysis
   UPDATE object_fluid_analysis
     SET analysis_no            = :NEW.analysis_no,
         object_id              = :NEW.object_id,
         object_class_name      = EcDp_Objects.getObjClassName(:New.object_id),
         daytime                = :NEW.daytime,
         analysis_type          = :NEW.analysis_type,
         sampling_method        = :NEW.sampling_method,
         phase                  = :NEW.phase,
         valid_from_date        = :NEW.valid_from_date,
         production_day         = :NEW.production_day,
         analysis_status        = :NEW.analysis_status,
         sample_press           = :NEW.sample_press,
         sample_temp            = :NEW.sample_temp,
         density                = :New.density,
         gas_density            = :NEW.gas_density,
         oil_density            = :NEW.oil_density,
         gross_liq_density      = :NEW.gross_liq_density,
         density_obs            = :NEW.density_obs,
         sp_grav                = :NEW.sp_grav,
         api                    = :NEW.api,
         shrinkage_factor       = :NEW.shrinkage_factor,
         solution_gor           = :NEW.solution_gor,
         bs_w                   = :NEW.bs_w,
         bs_w_wt                = :NEW.bs_w_wt,
         mol_wt                 = :New.mol_wt,
         cnpl_mol_wt            = :NEW.cnpl_mol_wt,
         cnpl_sp_grav           = :NEW.cnpl_sp_grav,
         cnpl_density           = :NEW.cnpl_density,
         mw_mix                 = :NEW.mw_mix,
         sg_mix                 = :NEW.sg_mix,
         sulfur_wt              = :NEW.sulfur_wt,
         gcv                    = :NEW.gcv,
         gcv_flash              = :NEW.gcv_flash,
         gcv_flash_press        = :NEW.gcv_flash_press,
         gcv_press              = :NEW.gcv_press,
         ncv                    = :NEW.ncv,
         gcr                    = :NEW.gcr,
         wdp                    = :NEW.wdp,
         rvp                    = :NEW.rvp,
         h2s                    = :NEW.h2s,
         co2                    = :NEW.co2,
         sand                   = :NEW.sand,
         salt                   = :NEW.salt,
         emulsion               = :NEW.emulsion,
         emulsion_frac          = :NEW.emulsion_frac,
         emulsion_fact          = :NEW.emulsion_fact,
         scale_inhib            = :NEW.scale_inhib,
         wax_content            = :NEW.wax_content,
         critical_press         = :NEW.critical_press,
         critical_temp          = :NEW.critical_temp,
         laboratory             = :NEW.laboratory,
         lab_ref_no             = :NEW.lab_ref_no,
         sampled_by             = :NEW.sampled_by,
         sampled_date           = :NEW.sampled_date,
         oil_in_water           = :NEW.oil_in_water,
         o2                     = :NEW.o2,
         chlorine               = :NEW.chlorine,
         aluminium              = :NEW.aluminium,
         barium                 = :NEW.barium,
         bicarbonate            = :NEW.bicarbonate,
         boron                  = :NEW.boron,
         calcium                = :NEW.calcium,
         carbonate              = :NEW.carbonate,
         chloride               = :NEW.chloride,
         hydroxide              = :NEW.hydroxide,
         iron                   = :NEW.iron,
         iron_total             = :NEW.iron_total,
         lithium                = :NEW.lithium,
         magnesium              = :NEW.magnesium,
         organic_acid           = :NEW.organic_acid,
         potassium              = :NEW.potassium,
         silicon                = :NEW.silicon,
         sodium                 = :NEW.sodium,
         strontium              = :NEW.strontium,
         sulfate                = :NEW.sulfate,
         phosphorus             = :NEW.phosphorus,
         cnpl_gcv               = :NEW.cnpl_gcv,
         cnpl_api               = :NEW.cnpl_api,
         vapour                 = :NEW.vapour,
         salinity               = :NEW.salinity,
         flash_gas_factor       = :NEW.flash_gas_factor,
         oil_in_water_content   = :NEW.oil_in_water_content,
         butanoate              = :NEW.butanoate,
         diss_solids            = :NEW.diss_solids,
         ethanoate              = :NEW.ethanoate,
         hexanoate              = :NEW.hexanoate,
         methanoate             = :NEW.methanoate,
         pentanoate             = :NEW.pentanoate,
         ph                     = :NEW.ph,
         propionate             = :NEW.propionate,
         resistivity            = :NEW.resistivity,
         sulfate_2              = :NEW.sulfate_2,
         susp_solids            = :NEW.susp_solids,
         tot_alkalinity         = :NEW.tot_alkalinity,
         sampling_point         = :NEW.sampling_point,
         fluid_state            = :NEW.fluid_state,
         check_unique           = :NEW.check_unique,
         component_set          = Nvl(:NEW.component_set,Nvl(EcBp_Fluid_Analysis.getCompSet(:new.object_class_name, :new.object_id, :new.daytime,:new.analysis_type), :new.analysis_type)),
         comments               = :NEW.comments,
         value_1                = :NEW.ofa_value_1,
         value_2                = :NEW.ofa_value_2,
         value_3                = :NEW.ofa_value_3,
         value_4                = :NEW.ofa_value_4,
         value_5                = :NEW.ofa_value_5,
         value_6                = :NEW.ofa_value_6,
         value_7                = :NEW.ofa_value_7,
         value_8                = :NEW.ofa_value_8,
         value_9                = :NEW.ofa_value_9,
         value_10               = :NEW.ofa_value_10,
         value_11               = :NEW.ofa_value_11,
         value_12               = :NEW.ofa_value_12,
         value_13               = :NEW.ofa_value_13,
         value_14               = :NEW.ofa_value_14,
         value_15               = :NEW.ofa_value_15,
         value_16               = :NEW.ofa_value_16,
         value_17               = :NEW.ofa_value_17,
         value_18               = :NEW.ofa_value_18,
         value_19               = :NEW.ofa_value_19,
         value_20               = :NEW.ofa_value_20,
         value_21               = :NEW.ofa_value_21,
         value_22               = :NEW.ofa_value_22,
         value_23               = :NEW.ofa_value_23,
         value_24               = :NEW.ofa_value_24,
         value_25               = :NEW.ofa_value_25,
         value_26               = :NEW.ofa_value_26,
         value_27               = :NEW.ofa_value_27,
         value_28               = :NEW.ofa_value_28,
         value_29               = :NEW.ofa_value_29,
         value_30               = :NEW.ofa_value_30,
         value_31               = :NEW.ofa_value_31,
         value_32               = :NEW.ofa_value_32,
         value_33               = :NEW.ofa_value_33,
         value_34               = :NEW.ofa_value_34,
         value_35               = :NEW.ofa_value_35,
         value_36               = :NEW.ofa_value_36,
         value_37               = :NEW.ofa_value_37,
         value_38               = :NEW.ofa_value_38,
         value_39               = :NEW.ofa_value_39,
         value_40               = :NEW.ofa_value_40,
         value_41               = :NEW.ofa_value_41,
         value_42               = :NEW.ofa_value_42,
         value_43               = :NEW.ofa_value_43,
         value_44               = :NEW.ofa_value_44,
         value_45               = :NEW.ofa_value_45,
         value_46               = :NEW.ofa_value_46,
         value_47               = :NEW.ofa_value_47,
         text_1                 = :NEW.ofa_text_1,
         text_2                 = :NEW.ofa_text_2,
         text_3                 = :NEW.ofa_text_3,
         text_4                 = :NEW.ofa_text_4,
         text_5                 = :NEW.ofa_text_5,
         text_6                 = :NEW.ofa_text_6,
         text_7                 = :NEW.ofa_text_7,
         text_8                 = :NEW.ofa_text_8,
         text_9                 = :NEW.ofa_text_9,
         text_10                = :NEW.ofa_text_10,
         text_11                = :NEW.ofa_text_11,
         text_12                = :NEW.ofa_text_12,
         text_13                = :NEW.ofa_text_13,
         text_14                = :NEW.ofa_text_14,
         text_15                = :NEW.ofa_text_15,
         text_16                = :NEW.ofa_text_16,
         text_17                = :NEW.ofa_text_17,
         text_18                = :NEW.ofa_text_18,
         text_19                = :NEW.ofa_text_19,
         text_20                = :NEW.ofa_text_20,
         text_21                = :NEW.ofa_text_21,
         text_22                = :NEW.ofa_text_22,
         text_23                = :NEW.ofa_text_23,
         text_24                = :NEW.ofa_text_24,
         text_25                = :NEW.ofa_text_25,
         text_26                = :NEW.ofa_text_26,
         text_27                = :NEW.ofa_text_27,
         text_28                = :NEW.ofa_text_28,
         text_29                = :NEW.ofa_text_29,
         text_30                = :NEW.ofa_text_30,
         text_31                = :NEW.ofa_text_31,
         text_32                = :NEW.ofa_text_32,
         text_33                = :NEW.ofa_text_33,
         text_34                = :NEW.ofa_text_34,
         text_35                = :NEW.ofa_text_35,
         text_36                = :NEW.ofa_text_36,
         text_37                = :NEW.ofa_text_37,
         text_38                = :NEW.ofa_text_38,
         text_39                = :NEW.ofa_text_39,
         text_40                = :NEW.ofa_text_40,
         text_41                = :NEW.ofa_text_41,
         text_42                = :NEW.ofa_text_42,
         date_1                 = :NEW.date_1,
         date_2                 = :NEW.date_2,
         date_3                 = :NEW.date_3,
         date_4                 = :NEW.date_4,
         date_5                 = :NEW.date_5,
         date_6                 = :NEW.date_6,
         date_7                 = :NEW.date_7,
         date_8                 = :NEW.date_8,
         date_9                 = :NEW.date_9,
         date_10                = :NEW.date_10,
         date_11                = :NEW.date_11,
         record_status          = :NEW.record_status,
         created_by             = :NEW.created_by,
         created_date           = :NEW.created_date,
         last_updated_by        = :NEW.last_updated_by,
         last_updated_date      = :NEW.last_updated_date,
         rev_no                 = :NEW.rev_no,
         rev_text               = :NEW.rev_text
	WHERE analysis_no           = :Old.analysis_no	;

   -- Update component analysis
    UPDATE fluid_analysis_component
    SET wt_pct = :New.wt_pct,
    mol_pct = :New.mol_pct,
    mol_wt = :New.mol_wt,
    density = :New.density,
    vol_pct = :New.vol_pct,
    energy_pct = :New.energy_pct,
    meas_mol_wt = :New.meas_mol_wt,
    meas_specific_gravity = :New.meas_specific_gravity,
    value_1 = :New.value_1,
    value_2 = :New.value_2,
    value_3 = :New.value_3,
    value_4 = :New.value_4,
    value_5 = :New.value_5,
    value_6 = :New.value_6,
    value_7 = :New.value_7,
    value_8 = :New.value_8,
    value_9 = :New.value_9,
    value_10 = :New.value_10,
    text_1 = :New.text_1,
    text_2 = :New.text_2,
    text_3 = :New.text_3,
    text_4 = :New.text_4,
    rev_text = :New.rev_text,
    rev_no = :New.rev_no,
    created_by =  :New.created_by,
    created_date=  :New.created_date,
    last_updated_by=  :New.last_updated_by,
    last_updated_date=  :New.last_updated_date,
    record_status = :New.record_status
    WHERE analysis_no = ln_analysis_no
    AND component_no = :Old.component_no;
END IF;

-- If inserting or updating, then generate values for new mapping
IF DELETING THEN

		IF :Old.component_no IS NOT NULL THEN
			-- Delete child row
			    SELECT COUNT(*) INTO v_count FROM v_fluid_analysis_comp vfa
				WHERE EXISTS(SELECT 1 FROM object_fluid_analysis ofa
							 WHERE ofa.object_id=vfa.object_id
							 AND ofa.daytime=vfa.daytime
							 AND ofa.analysis_type=vfa.analysis_type
							 AND ofa.sampling_method=vfa.sampling_method
							 AND ofa.phase=vfa.phase
							 AND ofa.object_id = :Old.object_id
							 AND ofa.daytime= :Old.daytime
							 AND ofa.analysis_type= :Old.analysis_type
							 AND ofa.sampling_method= :Old.sampling_method
							 AND ofa.phase= :Old.phase)
				AND component_no= :Old.component_no;

			    IF v_count <> 0 THEN
					 -- Get analysis_no from database
				    SELECT ofa.analysis_no
				    INTO ln_analysis_no
				    FROM object_fluid_analysis ofa
				    WHERE ofa.object_id = :Old.object_id
					 AND ofa.daytime = :Old.daytime
					 AND ofa.analysis_type = :Old.analysis_type
					 AND ofa.sampling_method = :Old.sampling_method
					 AND ofa.phase = :Old.phase;

				    DELETE FROM fluid_analysis_component
				    WHERE analysis_no = ln_analysis_no
					  AND component_no = :Old.component_no;
				END IF;

			-- Check how many record left in fluid_analysis_component(child).If NO record exist,then delete object_fluid_analysis(parent) record
				SELECT COUNT(*) INTO v_count FROM v_fluid_analysis_comp vfa
				WHERE EXISTS(SELECT 1 FROM object_fluid_analysis ofa
							 WHERE ofa.object_id=vfa.object_id
							 AND ofa.daytime=vfa.daytime
							 AND ofa.analysis_type=vfa.analysis_type
							 AND ofa.sampling_method=vfa.sampling_method
							 AND ofa.phase=vfa.phase
							 AND ofa.object_id = :Old.object_id
							 AND ofa.daytime= :Old.daytime
							 AND ofa.analysis_type= :Old.analysis_type
							 AND ofa.sampling_method= :Old.sampling_method
							 AND ofa.phase= :Old.phase);

					IF v_count = 0 THEN
					 -- Delete parent row
					   DELETE FROM v_object_fluid_analysis
					   WHERE object_id = :Old.object_id
						 AND daytime = :Old.daytime
						 AND analysis_type = :Old.analysis_type
						 AND sampling_method = :Old.sampling_method
						 AND phase = :Old.phase;
					END IF;

		END IF;

END IF;

END;

