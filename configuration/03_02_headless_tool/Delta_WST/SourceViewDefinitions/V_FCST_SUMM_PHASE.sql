CREATE OR REPLACE FORCE EDITIONABLE VIEW "V_FCST_SUMM_PHASE" ("FORECAST_ID", "OBJECT_ID", "FROM_MONTH", "TO_MONTH", "SORT_ORDER", "PHASE_CODE", "PHASE_NAME", "POT_UNCONSTR", "CONSTR", "POT_CONSTR", "S1P_SHORTFALL", "S1U_SHORTFALL", "S2_SHORTFALL", "INT_CONSUMPT", "LOSSES", "COMPENSATION", "AVAIL_EXPORT", "INJ", "RECORD_STATUS", "CREATED_BY", "CREATED_DATE", "LAST_UPDATED_BY", "LAST_UPDATED_DATE", "REV_NO", "REV_TEXT") AS 
  WITH mth_count AS (SELECT
      MONTHS_BETWEEN(MAX(TRUNC(end_date,'MONTH')),MIN(TRUNC(start_date,'MONTH'))) AS mth,MIN(TRUNC(start_date,'MONTH')) min_dt
      FROM forecast WHERE class_name='FORECAST_PROD' )
SELECT a.FORECAST_ID AS FORECAST_ID,
       a.OBJECT_ID AS OBJECT_ID,
       m1.MTH FROM_MONTH,
       m2.MTH TO_MONTH,
       a.SORT_ORDER AS SORT_ORDER,
       a.PHASE_CODE AS PHASE_CODE,
       a.PHASE_NAME AS PHASE_NAME,
       AVG(a.POT_UNCONSTR) AS POT_UNCONSTR,
       AVG(a.CONSTR) AS CONSTR,
       AVG(a.POT_CONSTR) AS POT_CONSTR,
       AVG(a.S1P_SHORTFALL) AS S1P_SHORTFALL,
       AVG(a.S1U_SHORTFALL) AS S1U_SHORTFALL,
       AVG(a.S2_SHORTFALL) AS S2_SHORTFALL,
       AVG(a.INT_CONSUMPT) AS INT_CONSUMPT,
       AVG(a.LOSSES) AS LOSSES,
       AVG(a.COMPENSATION) AS COMPENSATION,
       AVG(a.AVAIL_EXPORT) AS AVAIL_EXPORT,
       AVG(a.INJ) AS INJ,
       NULL AS RECORD_STATUS,
       NULL AS CREATED_BY,
       NULL AS CREATED_DATE,
       NULL AS LAST_UPDATED_BY,
       NULL AS LAST_UPDATED_DATE,
       NULL AS REV_NO,
       NULL AS REV_TEXT
FROM V_FCST_SUMM_PHASE_DAY a,
       (SELECT ADD_MONTHS(mth_count.min_dt, LEVEL-1) AS mth FROM ctrl_db_version,mth_count
        WHERE DB_VERSION=1 CONNECT BY LEVEL <= mth_count.mth+12) m1,
       (SELECT ADD_MONTHS(mth_count.min_dt, LEVEL-1) AS mth FROM ctrl_db_version,mth_count
        WHERE DB_VERSION=1 CONNECT BY LEVEL <= mth_count.mth+12) m2
WHERE TRUNC(a.DAYTIME, 'month') BETWEEN m1.MTH AND m2.MTH
GROUP BY a.FORECAST_ID, a.OBJECT_ID, a.PHASE_CODE, a.PHASE_NAME,a.SORT_ORDER, m1.MTH, m2.MTH
ORDER BY a.SORT_ORDER